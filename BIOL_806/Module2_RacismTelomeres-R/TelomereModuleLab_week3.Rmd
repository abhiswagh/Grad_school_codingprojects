---
title: "EDSS Lab assignment: Exploring National Health and Nutrition Examination Survey (NHANES) dataset"
author: "Abhi Wagh"
date: "04/11/22"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Assignment designed by Dax Ovid and revised by Rori Rohlfs

Please only provide one answer per question (i.e. your preferred plot, response, etc.)

# Good coding practices in RStudio

## (Q1) 
How would you improve the following code by adding spaces?  Make the changes below.  

```{r}
myfunc <- function(x) {
  
if(!is.vector(x)){
stop('x must be a vector')
}

else{
if(any(is.na(x))){
x<-x[!is.na(x)]
}
  
total<-length(x)
x_sum<-0
for(i in seq_along(x)){
x_sum<-x_sum+x[i]

}

x_sum/total
}
}
```

## (Q2) 
Next, how would you reformat this code to make it more readable?  Make the changes below.  

```{r} 
quadratic<-function(a=1, b=1, c=0){
  root<-sqrt(b^2-4*a*c)
  x1<-(-b+root)/2*a
  x2<-(-b-root)/2*a
print(x1, x2)
}
```

## (Q3) 
What about this code can be improved to make it readable?  Make the changes below.  

```{r}
x <- rnorm(100)
stats <- c(min(x), max(x), max(x)-min(x), 
quantile(x, probs=0.25), quantile(x, probs=0.75), 
IQR(x), median(x), mean(x), sd(x))
```

## (Q4) 
In the code below, how might you rename the variables to make them more informative?  Make the changes below.  
```{r}
x <- list(
  certificate_name = 'GOLD',
  purpose = 'Graduate Opportunities to Learn Data Science',
  place = 'San Francisco State',
  school_colors = 'Purple and GOLD!'
)
```

## Good coding practices article
Great! Now please read the following article on [Good coding practices](https://www.gastonsanchez.com/intro2cwd/coding.html) (Sections 28.1, 28.2, 28.3).


## (Q5) 
How did your changes/approach compare to the article's suggestions?

Most of my changes were similar to the article's suggestions. However, for number 2, I nested the rest of the code under the for loop. For number 3, the code was too long, so I broke it up according to the rules in the article afterwards. For number 4, I renamed the variables to the underscore format that I commonly use, as also mentioned in the article.


## (Q6) 
What did you learn about naming variables?

I learned to make sure the variable names are understandable by humans. There are many types of ways of naming, and I prefer underscore formatting.


## (Q7) 
What did you learn about informative comments?

The comments need to be easily understandable and consistent throughout the coding notebook.You should make lots of comments, so code is easily understandable.

## Additional resource
You can review this [Style Guide](http://adv-r.had.co.nz/Style.html) for some ideas on clear style.

For fun: Look at previous code you wrote and try to improve it!


# Exploring public databases

## (Q8) 
Does your field of interest use a public database?  If so, what are the databases your field uses?  If not, can you find public databases with keyworks from your field?

No, but I can find some databases. Mendeley Data is a good database to use for neuroscience-related data.

## (Q9) 
Select a public database related to your field.  How was this data collected?  Curated?  What's the data structure?  Are there R packages specifically designed for analyzing data from this source?  Include links to documentation for the R packages, if any.  

Mendeley Data. One specific study with data I found on this database has the data stored in xlsx format. Statistical data for Mendeley Data is in many formats, including .csv, which is commonly
used by R. Research is uploaded using cloud computing, share data with other people, and organize it. The database is organized by domain/major topics/keywords.


# Familiarizing ourselves with NHANES data

Prof. Leticia Márquez-Magaña directed us to [this NHANES 1999](https://wwwn.cdc.gov/nchs/nhanes/search/datapage.aspx?Component=Laboratory&CycleBeginYear=1999) data source. For this module we are specifically interested in the [telomere data](https://wwwn.cdc.gov/Nchs/Nhanes/1999-2000/TELO_A.htm).  Take a look at the links to answer the questions below.  

While it's not necessary for this assignment, if you'd like some additional context, here are the articles cited in NHANES documentation:

* [Cawthon 2002](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC115301/)
* [Needham 2013](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3666871/)


## (Q10) 
Describe in 3-4 sentences how the data was collected.

Those who were 20 years and older and completed NHANES surveys in 1999-2000 provided blood samples. These blood samples were used to measure other parameters like cholesterol. A bit of the samples was kept after the initial tests to analyze DNA via the telomere length assay.


## (Q11) 
Describe in 2-3 sentences what the TELO_A dataset contains.

The TELO_A dataset contains mean and standard deviation of telomere lengths of participants from the NHANES study. It is organized by respondent sequence number, mean T/S ratio values, and standard deviation of mean T/S ratio values.


## (Q12) 
What is the "T/S Ratio"? How was this calculated?

T/S ratio refers to measured telomere length/standard reference DNA. This was calculated by using PCR to obtain measured telomere lengths and then compared to standard reference DNA obtained from literature.
 

# Finding R packages for analyzing NHANES Data

## (Q13) 
What existing R packages can you find for analyzing NHANES data?  Include links to their R documentation.

- dplyr: http://127.0.0.1:38489/help/library/ggplot2/html/00Index.html
- ggplot2 (for plotting): http://127.0.0.1:38489/help/library/dplyr/html/00Index.html


## (Q14) 
Next, install these packages that will be useful to explore NHANES 1999-2000 data on telomere length: nhanesA, RNHANES, ggplot2, ggpubr, dplyr, psych

Here are two resources on installing R packages:

* [Option 1](http://derekogle.com/IFAR/supplements/installations/InstallPackagesRStudio.html)
* [Option 2](https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/install.packages)

```{r}
#YOUR ANSWER HERE
```


# Exploring NHANES 1999-2000 data

Make sure to load all 5 packages from above.
```{r, include='false'}
library(nhanesA)
library(RNHANES)
library(ggplot2)
library(ggpubr)
library(dplyr)
```

## (Q15) 
Learn more about the NHANES data packages by executing this code:
```{r}
??nhanesA
??RNHANES
```

Through those documentation resources, look up the function `nhanesTables()`.  Write code with `nhanesTables()` to look up lab results from 1999.  Make sure to include details!


```{r}
nhanesTables('LAB',
  year= 1999,
  nchar = 100,
  details = FALSE,
  namesonly = FALSE,
  includerdc = FALSE)
```

## (Q16) 
How many different file names are there in the NHANES 1999 lab dataset?

44


## (Q17) 
What's striking or interesting about of all these different lab results?  Keep these observations in mind if you plan to use NHANES data for your final project for this EDSS module.

So many different health conditions, specfic molecules, and general health parameters are being screened in these lab tests! 


## (Q18) 
What is the file name for the telomere data?

TELO_A

## (Q19) 
Write and execute code to explore the telomere dataset using `nhanesSearchTableNames()`.  Name one thing you learned about the dataset.

```{r}
nhanesSearchTableNames(
  pattern = 'TELO_A',
  ystart = 1999,
  ystop = 2000,
  includerdc = TRUE,
  nchar = 1000,
  details = TRUE
)
```
This dataset was updated in February 2015.

## (Q20) 
Now we want to look at the data in the telomere data table.  Look again in the nhanesA package description to find the function that can download an NHANES table.  Use that function to get the data table.

```{r}
nhanesTables('LAB', 1999)
nhanesTableVars('LAB', 'TELO_A')

tel_data <- nhanes('TELO_A')
tel_data
```


## (Q21) 
That's an overwhelming amount of data!  So big that most (~3237 rows) weren't displayed.  To get the hang of this data table, let's just look at the first few rows using the function `head()`.  What are the column names of the dataset?

```{r}
head(tel_data)
```

## (Q22) 
What do the column names represent?  Don't be shy to find online resources to help understand the meanings and include their links below.  How would you explain them to a colleague who is unfamiliar with the dataset?

The column names represent various health parameters, such as blood pressure and cardiovascular fitness. Body measures refers to measurements like height and weight. Audiometry refers to a hearing test. BIA is used to analyze fluid levels in the body, among other parameters.

https://wwwn.cdc.gov/nchs/nhanes/1999-2000/BMX.htm
https://wwwn.cdc.gov/nchs/nhanes/2009-2010/AUX_F.htm#:~:text=4)%20Pure%20tone%20air%20conduction,the%20range%20of%20human%20hearing.
https://wwwn.cdc.gov/nchs/nhanes/1999-2000/BIX.htm#:~:text=Bioelectrical%20impedance%20analysis%20(BIA)%20measures,and%20fat%2Dfree%20body%20mass.

## (Q23)
Inspired by the work of Dr Márquez-Magaña, we are considering age and racial/ethnic identity.  These data are collected with the demographics survey, so we need to access those data as well.  Write code with `nhanesTables()` to get to know the Demographics table(s) from 1999. 

Hint: It may be useful to look back to the `nhanesTables()` manual page.

```{r}
nhanesTables('DEMO', 1999)

nhanesTableVars('DEMO', 'DEMO')

demo <- nhanes('DEMO')
demo
```


## (Q24) 
What is the file name for the demographics data?

DEMO


## (Q25)
As before, look at the first few rows of the data table to get an idea about what information is contained.  

```{r}
head(demo)
```


## (Q26) 
How many columns are there in the demographics data?
```{r}
head(demo)
```
144 columns
 

## (Q27) 
If you're like me, the meaning of these column headings may not be obvious.  Seek an online resource to understand the column names (and data contained).  What resource did you use?  What are the meanings of some column headings?

Yes, these column headings were not all intuitively understandable. I used the CDC link below to understand what each column heading means. Some column headings are lsited as follows:

- DMAETHN: represents ethnicity
- DMDBORN: country of birth
- DMDEDUC: highest level of education received

https://wwwn.cdc.gov/nchs/nhanes/search/variablelist.aspx?Component=Demographics&Cycle=1999-2000


## (Q28)
Now that you understand the column names, what is striking or interesting of all this demographic data?  Keep these observations in mind if you plan to use NHANES data for your final project for this EDSS module.

It's interesting that this is mentioned for the age column: "Age in years of the household reference person at the time of HH screening. Individuals 85 and over are topcoded at 85 years of age."

I wonder why 85 is listed as the limit, even if individuals above this age are participating in the survey. Seems kind of ageist, unless the scientists running the study are doing it for some statistically/analytically significant reason? 

## (Q29) 
What are the column names that are relevant for us?  That is, what are the column names for: participants identifiers, age, race, and ethnicity?

- SEQN refers to the participant's sequence number. 
- DMDHRAGE: age
- DMARACE: race
- DMAETHN: ethnicity 

## (Q30) 
Write and execute code to explore the race and ethnicity data specifically.  Try to make an exploratory visualization.  What do you notice?
```{r}
nhanes('DEMO')

```
There is no race and ethnicity data for 1999, as the columns for DMAETHN and DMARACE say N/A for everything...


## (Q31) 
To look into our questions, we will make scatterplots using both the telomere and demographic data.  How can you imagine arranging all that data in order to draw informative scatter plots combining telomere and demographic data?

I imagine it will take a lot of isolating specific columns of data from the demographic data as well as possibly combining dataframes to get the appropriate data we want to plot. After organizing the data into the correct tables and columns we are looking for, then we can plot the data into scatterplots using ggplot2.


## (Q32) 
Write and execute code to assign TELO_A as dataframe with an informative variable name. 
Hint: you may have already done this, but if not, now's the time.  
```{r}
tel_data
#I assigned tel_data variable name to the TELO_A dataframe above in an earlier question.
```


## (Q33) 
Write and execute code to assign DEMO as dataframe with an informative variable name.  
Hint: Same thing.

```{r}
#I did more or less the same thing in an earlier question
demo
```

# Merging telomere and demographic data
To answer new and creative questions, we often need to merge data across sources.  We are at that point in this project.  This is exciting!  R has a convenient function just for this purpose: `merge()`.

## (Q34) 
Look at the manual for the `merge()` function.  With that information, merge your telomere and demographic datasets, making sure to match the individuals.  Save your new combined table with a descriptive name.

```{r}
merged <- merge(tel_data, demo)
merged
```

## (Q35) 
View your NEW spectacular dataset with `view()` and/or click the blue arrow in the environment panel.  Does it look as you expect?

Yes, it's very cool! I assumed the datasets were merged based on the SEQN column?


## (Q36) 
Merging datasets is where data science gets AWEsome and creative!!! You now have access to more connected data, which makes it possible to answer a whole new set of questions!!!  What kinds of questions would you ask related to topics you care about? 

I wonder how cholesterol levels relate to race/ethnicity, as some races/ethnicities have a higher genetic predisposition to developing high cholesterol. However, there is also a lifestyle and nutrition component to it. I wonder which factor is more correlated to the incidence of high cholesterol: genetics or whether there is access to nutritious foods.(I've heard most of dietary cholesterol doesn't really affect our cholesterol levels too much, but I don't really know the full science behind it all.)


You've looked at data, wrangled data, formatted data and are now set up for more exploratory analysis next week!  Get ready to create some scatter plots and compute some stats!

# Forming your research question

Now that you've managed to wrangle the NHANES data, it's time to shift gears to get specific about the class' research question.  It may be useful for you to consider [this summary](https://www.rdocumentation.org/packages/NHANES/versions/2.1.0/topics/NHANES) of the variables represented in NHANES.  

Note, now that you're more used to the .Rmd format, the questions below will have explicit 'YOUR ANSWER HERE' indicators. 

## (Q37)
How would you write out the class' research question(s) based on what we've learned in class?
Hint: Reference April 4th's class on the work of Prof. Leticia Márquez-Magaña

How does race/ethnicity impact telomere length/shortening over time? How, if at all, are these variables correlated?

## (Q38)
Take a moment to draw out (on paper) the graph we're trying to make to answer this. Include an image of your drawing in your knitted report file.  


## (Q39)
Compare your plot drawing with your team members'.  Name a few similarities/differences between your drawings.

We bascially had the same graph.

# Working with the merged data
Back to the data frame you created.  Let's try to better understand the data in there and how we can use it to answer your question and draw your plot.  

## (Q40)
Explore the structure of your merged dataset with head(), str(), colnames(), others?

```{r}
head(merged)
str(merged)
colnames(merged)

merged
```


## (Q41)
In your own words, describe what the rows and columns of the data frame represent.  You don't have to be exhaustive, but do include the number of rows and columns.  

The rows represent NHANES data associated with each respondent, while the columns represent the various parameters measured in the NHANES study. There are 3,570 rows and 146 columns in this merged dataset, shown above.

## (Q42)
Seems like there are a lot of columns that are not relevant to our specific research question.  You can use these other columns for multivariable analysis (skip to next question) OR you can create a new data frame with just the columns you need for this particular question.

```{r}
relevant_data <- data.frame(merged$SEQN, merged$TELOMEAN, merged$RIDRETH1, merged$RIDAGEYR)

relevant_data
```


# Creating an informative scatterplot

## (Q43)
Start with using ggplot() function + geom_point() to make a scatterplot.  At this point, do not separate by race/ethnicity, use the cumulative data.
```{r}
ethn_codes <- nhanesTranslate(
'DEMO',
colnames = "RIDRETH1",
data = NULL,
nchar = 32,
mincategories = 2,
details = TRUE,
dxa = FALSE
)

ethn_codes

relevant_data_all <- merge(relevant_data,ethn_codes)
relevant_data_all
```

```{r}
ggplot(relevant_data_all, aes(x=merged.RIDAGEYR, y=merged.TELOMEAN)) +  geom_point() +
geom_smooth(method=lm) +
 xlab("Age") + 
 ylab("Mean T/S Ratio") +
   ggtitle("Mean T/S Ratio vs. Age") + stat_cor(method='pearson')
```

## (Q44) 
Now add a trendline, axes labels w/ units of measurement, R and p values.  Useful functions could include + geom_smooth(method=lm) + stat_cor(method='pearson').  You can learn more about these functions from RDocumentation.

done.

## (Q45)
What do you notice about the scatterplot?  Is there a positive or negative trend?  How strong is the correlation?

There's a slightly negative correlation that is not super strong of a correlation.

# Comparing telomere length to age across race/ethnicity groups

As it is, `RIDRETH1` uses numbers 1-5 to each represent different racial and ethnic categories.  We'll want to recode each number as a word or abbreviation that represents the categories.  For example, instead of "1" the factor is labeled as "Mexican" based on the [NHANES codebook](https://wwwn.cdc.gov/Nchs/Nhanes/1999-2000/DEMO.htm#RIDRETH1).  

## (Q46)
First let's think about the data we're choosing.  Is there a difference between RIDRETH1 and RIDRETH2?  How will you make the choice as a data scientist about which way/how to represent these categories?  (You can disagree with the suggestion to use `RIDRETH1` if you feel it) What are the limitations of these categories? Who is not represented?

RIDRETH2 wasn't included in this dataset. It provided an analytic link to race when it was used. 

## (Q47)
Recode the racial and ethnic categories based on NHANES codebook.  Assign the recode to a new column in the dataframe (you can pick the variable name).  Use RIDRETH1 and recode() to change the numbers (1-5) to the names of racial and ethnic factors. 
Hint: You may have to unclass() the variable RIDRETH1 in order to recode.  

```{r}
dfnew <- merged[("RIDRETH1")]
```

```{r}
dfage <- merged[("RIDAGEYR")]
```

```{r}
unclassedRIDRETH <- unclass(merged$RIDRETH1)

new_RIDRETH <- recode(unclassedRIDRETH,'1' = "Mexican-American", '2' = "Hispanic", '3' = "Non Hispanic White", '4' = "Non Hispanic Black", '5' = "Non Hispanic (including multiracial)")

merged$new_RIDRETH <- new_RIDRETH

head(merged$new_RIDRETH)
```

## (Q48)
Make separate scatterplots by race/ethnicity categories.  There are many ways to do this, one way is with `facet_wrap()`.

```{r}
ggplot(merged, aes(x=RIDAGEYR, y=TELOMEAN)) + geom_point() + geom_smooth(method=lm) + stat_cor(method='pearson') +
  facet_wrap(~ new_RIDRETH)+
  xlab("Age") + 
  ylab("Mean T/S Ratio")
```

## (Q49)
Now include trendlines, axes labels, units of measurements, R and p values.

done.

## (Q50)
What do you notice about the scatterplots for different Racial/Ethnic categories?  How would you interpret these plots?  

The First and third quartile values appear to be larger for black and white races as compared to the other races.

# Interpreting the plots
We previously shared our scatterplots with Prof. Leticia Márquez-Magaña.  Respond to these follow-up questions regarding the data:

## (Q51) 
"It looks like the age range is 18-80. Is this the case?"  

Yes.

## (Q52)
Examine the age ranges, means, medians, and distributions across racial/ethnic categories.
Hint: You can answer this question numerically with summary() and visually with histograms

```{r}
summary(dfage)
```

## (Q53)
What do you notice when you compare age distributions across racial/ethnic categories?  Include in your interpretation the group with the highest and lowest median age in NHANES.  

The median age appears to be slightly different across races. 

## (Q54)
Given what we know about telomeres and aging, how might varying age distributions across race/ethnicity categories affect how we interpret our results?

Telomeres and age are correlated in that they shorten as age increases. Since age distribution varies across racial and ethnic categories, this may complicate our interpretations of the results. It may be best to interpret data according to these categories.

## (Q55)
OPTIONAL BONUS CHALLENGE: Given that each race/ethnicity group has different ages represented, how might we subset or standardize the data to draw comparisons?  See if you can implement your idea.  

## (Q56)
Another question from Prof. Leti Márquez Magaña: "What percent of the NHANES participants [with telomere data] are white?"

about 47%

```{r}
library(dplyr)
count(merged, new_RIDRETH)
(1667/3570)*100
```


# Exploring scatterplot statistics
## (Q57) 
What is the linear regression line for each racial and ethnic category?
Hint: Try `lm()`, lm stands for linear model

R values for each racial and ethnic category are below.

```{r}
ggplot(merged, aes(x=RIDAGEYR, y=TELOMEAN)) + geom_point() + geom_smooth(method=lm) + stat_cor(method='pearson') +
  facet_wrap(~ new_RIDRETH)+
  xlab("Age") + 
  ylab("Mean T/S Ratio")
```

# Your own NHANES research analysis!

You've analyzed the relationship between telomere lengths and age across race/ethnicity groups!  In the process, you've learned about the underlying biology, about the data, and about this analytical approach.  With all of this knowledge and skill, you're prepared to ask and answer your own scientific question using the same NHANES data.  

Note, this is like the Great British Baking Show, as you get more advanced, you get less specific instructions. 

## (Q58)
Collaboratively with your team, identify a scientific research question that you can address using the NHANES data.  Your question needs to be different from what we've done so far in this module, but doesn't need to be totally unique or novel. 

What is the relationship between household income and access to mental health resources during the COVID-19 pandemic?

## (Q59)
Assemble the data frame that you need in order address your scientific research question.  

```{r}
twenty_data <- read.csv("health4_se_week21_dec9to21_2020.xlsx - US.csv")
twentyone_data <- read.csv("health4_week40_dec1to13_2021.xlsx - US.csv")

twenty_data
twentyone_data

#this data is not tidy, so we are extracting data columns/rows of interest and cleaning it up below
```


## (Q60)
Use that data frame to perform analyses to address your research question.  Your analysis should include visualization(s) and statistical result(s).  

```{r}
#removing unnecessary data rows from dataset and isolating just the income data

income_mental_health_2020 <- twenty_data[-c(1:54, 64:74), ]
income_mental_health_2021 <- twentyone_data[-c(1:73, 83:129), ]

income_mental_health_2020
income_mental_health_2021
```

```{r}
#removing unnecessary data columns from dataset and isolating just the income data

total_income_mental_health_2020 <- subset(income_mental_health_2020, select = -c(X:X.3, X.7:X.9))
total_income_mental_health_2021 <- subset(income_mental_health_2021, select = -c(X:X.3, X.7:X.9))

total_income_mental_health_2020
total_income_mental_health_2021

#renaming columns and merging datasets

names(total_income_mental_health_2020)[names(total_income_mental_health_2020) == 'Standard.Error.Health.Table.4..Mental.Health.Activities.in.the.Last.4.Weeks..by.Select.Characteristics..United.States'] <- 'income'

names(total_income_mental_health_2020)

names(total_income_mental_health_2021)[names(total_income_mental_health_2021) == 'Health.Table.4..Mental.Health.Activities.in.the.Last.4.Weeks..by.Select.Characteristics..United.States'] <- 'income'

names(total_income_mental_health_2021)

merged_data <- merge(total_income_mental_health_2020,total_income_mental_health_2021, by= "income")
merged_data

#renaming columns for clarity

names(merged_data)[names(merged_data) == 'X.4.x'] <- 'Need Counseling Not Get 20'
names(merged_data)[names(merged_data) == 'X.5.x'] <- 'Did Not Need Not Get 20'
names(merged_data)[names(merged_data) == 'X.6.x'] <- 'Did Not Report 20'

names(total_income_mental_health_2020)

names(merged_data)[names(merged_data) == 'X.4.y'] <- 'Need Counseling Not Get 21'
names(merged_data)[names(merged_data) == 'X.5.y'] <- 'Did Not Need Not Get 21'
names (merged_data)[names(merged_data) == 'X.6.y'] <- 'Did Not Report 21'

names(merged_data)

merged_data

```

```{r}
library(ggplot2)
library(tidyverse)
library(forcats)

new_data_merged <- read.csv("NEW_DATASET_COVID_MENTALHEALTH2020-2021 - Sheet1.csv")

#cols.num <- c("Needed.Counseling.But.Did.Not.Get..2020.","Did.Not.Need.Counseling.And.Did.Not.Get..2020.", "Did.Not.Report..2020.","Needed.Counseling.But.Did.Not.Get..2021.","Did.Not.Need.Counseling.And.Did.Not.Get..2021.", "Did.Not.Report..2021.")

require(tidyr)

"merged_data.long <- gather(merged_data, variable,value, -income)
merged_data.long"

new_data_merged$need_not_get_20 = as.numeric(gsub('\\$|,', '', new_data_merged$Needed.Counseling.But.Did.Not.Get..2020.))

new_data_merged$need_not_get_21 = as.numeric(gsub('\\$|,', '', new_data_merged$Needed.Counseling.But.Did.Not.Get..2021.))

new_data_merged$did_not_need_or_get_20 = as.numeric(gsub('\\$|,', '', new_data_merged$Did.Not.Need.Counseling.And.Did.Not.Get..2020.))

new_data_merged$did_not_need_or_get_21 = as.numeric(gsub('\\$|,', '', new_data_merged$Did.Not.Need.Counseling.And.Did.Not.Get..2021.))

new_data_merged$did_not_report_20 = as.numeric(gsub('\\$|,', '', new_data_merged$Did.Not.Report..2020.))

new_data_merged$did_not_report_21 = as.numeric(gsub('\\$|,', '', new_data_merged$Did.Not.Report..2021.))

new_data_merged

need_couns_not_get <- new_data_merged[c(2,9:10)]
need_couns_not_get

#adding columns of data that are converted from chr to numeric.

need_couns_not_get.long <- gather(need_couns_not_get, variable,value, -Income)

need_couns_not_get.long

ggplot(data = need_couns_not_get.long, aes(x = fct_inorder(Income), y = value, fill = variable)) +
  geom_col(position = position_dodge()) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))+
  theme(axis.text.x = element_text(angle = 90))+
  ggtitle("Number of Individuals That Needed Therapy But Didn't Receive It Per Income Range")+
  xlab("Income Ranges") + 
  ylab("Number of Individuals") 

#Need_not_get for 2020 and 2021

mean(new_data_merged$need_not_get_20)
sd(new_data_merged$need_not_get_20)

mean(new_data_merged$need_not_get_21)
sd(new_data_merged$need_not_get_21)

#Didn't need and didn't get for 2020 and 2021

mean(new_data_merged$did_not_need_or_get_20)
sd(new_data_merged$did_not_need_or_get_20)

mean(new_data_merged$did_not_need_or_get_21)
sd(new_data_merged$did_not_need_or_get_21)

#Didn't report for 2020 and 2021
mean(new_data_merged$did_not_report_20)
sd(new_data_merged$did_not_report_20)

mean(new_data_merged$did_not_report_21)
sd(new_data_merged$did_not_report_21)
```
```{r}
hist(c(new_data_merged$need_not_get_21), 
       main="Histogram for Number of Individuals That Needed Therapy But Didn't Receive It Per Income Range", 
       xlab="Number of Individuals")

hist(c(new_data_merged$did_not_need_or_get_21), 
       main="Number of Individuals That Didn't Need Therapy and Didn't Receive It Per Income Range", 
       xlab="Number of Individuals")

hist(c(new_data_merged$did_not_report_21), 
       main="Histogram for Individuals That Didn't Report", 
       xlab="Number of Individuals")

```

```{r}
didnotneed_didnotget <- new_data_merged[c(2, 11: 12)]
didnotneed_didnotget

didnotneed_didnotget.long <- gather(didnotneed_didnotget, variable,value, -Income)

didnotneed_didnotget.long

ggplot(data = didnotneed_didnotget.long, aes(x = fct_inorder(Income), y = value, fill = variable)) +
  geom_col(position = position_dodge()) +
  scale_x_discrete(limits = c("Did not report","Less than $25,000","$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 - $99,999", "$100,000 - $149,999","$150,000 - $199,999","$200,000 and above")) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))+
  theme(axis.text.x = element_text(angle = 90))+
  ggtitle("Number of Individuals That Didn't Need Therapy and Didn't Receive It Per Income Range")+
  xlab("Income Ranges") + 
  ylab("Number of Individuals") 
```
```{r}
didnotreport <- new_data_merged[c(2, 13:14)]
didnotreport

didnotreport.long <- gather(didnotreport, variable,value, -Income)

didnotreport.long

ggplot(data = didnotreport.long, aes(x = fct_inorder(Income), y = value, fill = variable)) +
  geom_col(position = position_dodge()) +
  scale_x_discrete(limits = c("Did not report","Less than $25,000","$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 - $99,999", "$100,000 - $149,999","$150,000 - $199,999","$200,000 and above")) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))+
  theme(axis.text.x = element_text(angle = 90))+
  ggtitle("Number of Individuals That Did Not Report About Therapy")+
  xlab("Income Ranges") + 
  ylab("Number of Individuals") 
```
```{r}
all_data_2020 <- new_data_merged[c(2, 9, 11, 13)]
all_data_2020

all_data_2020.long <- gather(all_data_2020, variable,value, -Income)

all_data_2020.long

ggplot(data = all_data_2020.long, aes(x = fct_inorder(Income), y = value, fill = variable)) +
  geom_col(position = position_dodge()) +
  scale_x_discrete(limits = c("Did not report","Less than $25,000","$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 - $99,999", "$100,000 - $149,999","$150,000 - $199,999","$200,000 and above")) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))+
  theme(axis.text.x = element_text(angle = 90))+
  ggtitle("Composite Data 2020")+
  xlab("Income Ranges") + 
  ylab("Number of Individuals") 
```
```{r}
all_data_2021 <- new_data_merged[c(2, 10, 12, 14)]
all_data_2021

all_data_2021.long <- gather(all_data_2021, variable,value, -Income)

all_data_2021.long

ggplot(data = all_data_2021.long, aes(x = fct_inorder(Income), y = value, fill = variable)) +
  geom_col(position = position_dodge()) +
  scale_x_discrete(limits = c("Did not report","Less than $25,000","$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 - $99,999", "$100,000 - $149,999","$150,000 - $199,999","$200,000 and above")) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))+
  theme(axis.text.x = element_text(angle = 90))+
  ggtitle("Composite Data 2021")+
  xlab("Income Ranges") + 
  ylab("Number of Individuals") 
```

## (Q61)
Interpret your results in the biological context that you've learned about in this module.  You can go on to think about limitations on your analysis, and future directions.  

*in presentation video

## (Q62)
As a team, create a 4-7 minute video that explains
* your research question
* the data you used
* your data analysis results
* how you interpret those results
Your video should additionally include [author contributions](https://www.elsevier.com/authors/policies-and-guidelines/credit-author-statement) (you can do this visually (with text) or verbally).  Post your video on the module-3 slack channel.  